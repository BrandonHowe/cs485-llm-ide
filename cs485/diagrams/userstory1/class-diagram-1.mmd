classDiagram
class VSCloneChatHistoryContribution {
  +register(): void
  +dispose(): void
}
class VSCloneChatSessionBridge {
  +start(): void
  +stop(): void
}
class VSCloneUnifiedChatViewPane {
  +renderBody(container): void
  +layoutRegions(): void
}
class VSCloneChatHistoryRail {
  +refresh(): void
  +revealTurn(threadId, turnId): void
}
class VSCloneChatHistoryTreeDataSource {
  +getChildren(element): Promise~Node[]~
  +getLabel(node): string
}
class VSCloneChatHistoryCommandRegistrar {
  +registerCommands(): void
}
class VSCloneChatHistoryService {
  +initialize(): Promise~void~
  +getThreads(query): Thread[]
  +getTurns(threadId): Turn[]
  +applyTurnUpdate(update): Promise~void~
  +archiveThread(threadId, archived): Promise~void~
  +deleteThread(threadId): Promise~void~
  +clearAll(scope): Promise~void~
}
class VSCloneChatHistoryModel {
  +upsertThread(meta): void
  +upsertTurn(update): void
  +queryThreads(query): Thread[]
  +getTurns(threadId): Turn[]
}
class VSCloneChatHistoryStore {
  +loadSnapshot(): Promise~Snapshot~
  +persistThread(threadId): Promise~void~
  +persistIndex(): Promise~void~
  +deleteThread(threadId): Promise~void~
  +purge(policy): Promise~number~
}
class VSCloneChatHistorySerializer {
  +serializeIndex(snapshot): string
  +serializeThread(thread): string
  +deserializeIndex(raw): Snapshot
  +deserializeThread(raw): Thread
}
class VSCloneChatHistoryMigrationService {
  +migrateIndex(raw): Snapshot
  +migrateThread(raw): Thread
}

VSCloneChatHistoryContribution --> VSCloneChatSessionBridge
VSCloneChatHistoryContribution --> VSCloneChatHistoryCommandRegistrar
VSCloneChatSessionBridge --> VSCloneChatHistoryService
VSCloneChatHistoryTreeDataSource --> VSCloneChatHistoryService
VSCloneChatHistoryService --> VSCloneChatHistoryModel
VSCloneChatHistoryService --> VSCloneChatHistoryStore
VSCloneChatHistoryStore --> VSCloneChatHistorySerializer
VSCloneChatHistoryStore --> VSCloneChatHistoryMigrationService

VSCloneChatHistoryContribution --> VSCloneUnifiedChatViewPane
VSCloneUnifiedChatViewPane --> VSCloneChatHistoryRail
VSCloneUnifiedChatViewPane --> VSCloneChatHistoryService
VSCloneChatHistoryRail --> VSCloneChatHistoryTreeDataSource
VSCloneChatHistoryRail --> VSCloneChatHistoryService
