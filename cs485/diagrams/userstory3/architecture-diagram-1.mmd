flowchart LR
  subgraph Client["Workbench Renderer (Client)"]
    Dev["Developer"]
    ChatUI["VSClone Unified Chat View"]
    HistRail["History Rail"]
    Composer["Composer Toolbar"]
    PickerCtl["VSCloneModelPickerController"]
    Catalog["VSCloneModelCatalogService"]
    Compat["VSCloneModelCompatibilityService"]
    SelectSvc["VSCloneThreadModelSelectionService"]
    PrefStore["VSCloneModelPreferenceStore"]
    ConfigBridge["VSCloneProviderConfigurationBridge"]
  end

  subgraph Server["Extension Host / Workbench Services"]
    LMService["ILanguageModelsService"]
    LMConfig["ILanguageModelsConfigurationService"]
    ChatSvc["IChatService (sendRequest)"]
  end

  subgraph Local["Local Profile Storage"]
    KVS[("storage keys\nselection + recents")]
    LMFile[("chatLanguageModels.json")]
    Secrets[("Secret Storage")]
  end

  subgraph Cloud["LLM Providers (Cloud)"]
    ProviderA["Provider A API"]
    ProviderB["Provider B API"]
  end

  Dev -->|select active thread| HistRail
  Dev -->|open dropdown / select model| Composer
  ChatUI --> HistRail
  ChatUI --> Composer
  Composer --> PickerCtl
  PickerCtl --> Catalog
  PickerCtl --> Compat
  PickerCtl --> SelectSvc
  HistRail -->|active thread context| SelectSvc

  Catalog -->|vendors + models + metadata| LMService
  Compat -->|capability checks| LMService
  SelectSvc -->|persist thread selection + recents| PrefStore
  PrefStore --> KVS

  PickerCtl -->|configure provider if needed| ConfigBridge
  ConfigBridge --> LMConfig
  LMConfig --> LMFile
  LMConfig --> Secrets

  SelectSvc -->|userSelectedModelId for active thread| ChatSvc
  ChatSvc --> ProviderA
  ChatSvc --> ProviderB
