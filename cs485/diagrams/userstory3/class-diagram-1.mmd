classDiagram
class VSCloneModelSwitcherContribution {
  +register(): void
  +dispose(): void
}

class VSCloneModelCatalogService {
  +refreshCatalog(): Promise~void~
  +getProviders(): Provider[]
  +getModels(providerId): Model[]
}

class VSCloneModelAvailabilityService {
  +getProviderState(providerId): AvailabilityState
  +getModelState(modelId): AvailabilityState
}

class VSCloneModelCompatibilityService {
  +filterSupported(models, context): Model[]
  +explainIncompatibility(model, context): string|undefined
}

class VSCloneThreadModelSelectionService {
  +initialize(): Promise~void~
  +getCurrentSelectionForThread(threadId, location): Selection|undefined
  +setSelectionForThread(threadId, selection): Promise~void~
  +switchToNextModel(threadId, location): Promise~Selection|undefined~
  +resetSelectionForThread(threadId): Promise~void~
}

class VSCloneModelPreferenceStore {
  +load(): PreferencesSnapshot
  +saveSelection(selection): void
  +saveRecent(modelId): void
  +clear(): void
}

class VSCloneProviderConfigurationBridge {
  +listProviderGroups(providerId): Group[]
  +openProviderConfig(providerId): Promise~void~
  +validateProviderConfiguration(providerId): Promise~ValidationResult~
}

class VSCloneModelPickerController {
  +open(context): Promise~void~
  +buildSections(context): PickerSection[]
  +applySelection(selection): Promise~void~
}

class VSCloneUnifiedChatModelSwitcherActionItem {
  +renderLabel(container): void
  +show(): void
  +updateActions(): void
}

class VSCloneModelSwitcherActionRegistrar {
  +registerCommands(): void
}

class VSCloneModelSelectionMigrationService {
  +migrate(snapshot): PreferencesSnapshot
}

VSCloneModelSwitcherContribution --> VSCloneModelSwitcherActionRegistrar
VSCloneModelSwitcherContribution --> VSCloneModelPickerController
VSCloneModelSwitcherContribution --> VSCloneThreadModelSelectionService

VSCloneModelPickerController --> VSCloneModelCatalogService
VSCloneModelPickerController --> VSCloneModelAvailabilityService
VSCloneModelPickerController --> VSCloneModelCompatibilityService
VSCloneModelPickerController --> VSCloneThreadModelSelectionService
VSCloneModelPickerController --> VSCloneProviderConfigurationBridge

VSCloneThreadModelSelectionService --> VSCloneModelPreferenceStore
VSCloneThreadModelSelectionService --> VSCloneModelSelectionMigrationService
VSCloneThreadModelSelectionService --> VSCloneModelCatalogService

VSCloneUnifiedChatModelSwitcherActionItem --> VSCloneModelPickerController
